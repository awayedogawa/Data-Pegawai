<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Editor Undangan - SIMDIK-TANBU</title>
    
    <!-- Skrip penjaga login telah dihapus dari sini -->

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Times+New+Roman&display=swap" rel="stylesheet">

    <style>
        :root {
            --primary-color: #4F46E5; --primary-hover: #4338CA;
            --gray-100: #F3F4F6; --gray-200: #E5E7EB; --gray-500: #6B7280;
            --gray-700: #374151; --gray-900: #111827;
            --background-color: #F9FAFB; --card-background: #FFFFFF;
            --shadow-md: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        body {
            font-family: 'Inter', sans-serif; background-color: var(--background-color);
            margin: 0; color: var(--gray-700);
            display: flex;
            height: 100vh;
            overflow: hidden;
        }
        .sidebar {
            width: 320px;
            background-color: var(--card-background);
            border-right: 1px solid var(--gray-200);
            display: flex;
            flex-direction: column;
            height: 100%;
        }
        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray-200);
        }
        .sidebar-header h2 {
            margin: 0;
            font-size: 1.25rem;
            color: var(--gray-900);
        }
        .activity-list {
            list-style: none;
            margin: 0;
            padding: 0;
            overflow-y: auto;
            flex-grow: 1;
        }
        .activity-item {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--gray-100);
            cursor: pointer;
            transition: background-color 0.2s;
        }
        .activity-item:hover {
            background-color: var(--gray-100);
        }
        .activity-item.active {
            background-color: #DBEAFE;
            border-right: 3px solid var(--primary-color);
        }
        .activity-item strong {
            display: block;
            color: var(--gray-900);
            font-weight: 500;
        }
        .activity-item span {
            font-size: 0.875rem;
            color: var(--gray-500);
        }

        .editor-container {
            flex-grow: 1;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            height: 100vh;
            box-sizing: border-box;
        }
        .editor-toolbar {
            margin-bottom: 1.5rem;
            display: flex;
            justify-content: space-between;
        }
        .action-button {
            background-color: var(--primary-color); color: white; border: none; padding: 10px 16px;
            font-size: 14px; font-weight: 500; border-radius: 6px; cursor: pointer;
            text-decoration: none; display: inline-flex; align-items: center; gap: 8px;
            transition: background-color 0.2s ease;
        }
        .action-button:hover { background-color: var(--primary-hover); }
        .back-button { background-color: var(--gray-200); color: var(--gray-700); }
        .back-button:hover { background-color: var(--gray-200); }

        .editor-area {
            background-color: var(--card-background);
            box-shadow: var(--shadow-md);
            flex-grow: 1;
            overflow-y: auto;
            padding: 2.5cm; /* A4 padding */
            width: 21cm; /* A4 width */
            min-height: 29.7cm; /* A4 height */
            margin: 0 auto;
            box-sizing: border-box;
        }
        .page {
            font-family: 'Times New Roman', serif;
            font-size: 12pt;
            line-height: 1.5;
            color: #000;
        }
        .page[contenteditable="true"]:focus {
            outline: none;
        }
        #placeholder {
            display: flex;
            height: 100%;
            justify-content: center;
            align-items: center;
            text-align: center;
            color: var(--gray-500);
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .editor-area, .editor-area * {
                visibility: visible;
            }
            .editor-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                height: 100%;
                padding: 1.5cm; /* Adjust print margins */
                box-shadow: none;
                border: none;
            }
        }
    </style>
</head>
<body>
    <div class="sidebar">
        <div class="sidebar-header">
            <h2>Pilih Kegiatan</h2>
        </div>
        <ul id="activityList" class="activity-list">
            <li><div class="activity-item">Memuat...</div></li>
        </ul>
    </div>
    <div class="editor-container">
        <div class="editor-toolbar">
            <a href="index.html" class="action-button back-button">Kembali ke Dashboard</a>
            <button id="printButton" class="action-button" disabled>Cetak Undangan</button>
        </div>
        <div class="editor-area">
            <div id="placeholder">
                <div>
                    <h3>Editor Undangan</h3>
                    <p>Silakan pilih kegiatan dari panel sebelah kiri untuk memulai.</p>
                </div>
            </div>
            <div id="pageContent" class="page" contenteditable="true" style="display: none;"></div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { getFirestore, collection, getDocs } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyBM4RhHUdQxSEPVBGhjf4R8UGfzMmD7egU",
            authDomain: "dashboard-kegiatan-saya.firebaseapp.com",
            projectId: "dashboard-kegiatan-saya",
            storageBucket: "dashboard-kegiatan-saya.appspot.com",
            messagingSenderId: "1078549240220",
            appId: "1:1078549240220:web:7d372e7b50b6f9545a9059"
        };
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const activityListEl = document.getElementById('activityList');
        const placeholderEl = document.getElementById('placeholder');
        const pageContentEl = document.getElementById('pageContent');
        const printButton = document.getElementById('printButton');

        let allActivities = [];

        const formatDateRange = (startStr, endStr) => {
            if (!startStr || !endStr) return '';
            const months = ["Januari", "Februari", "Maret", "April", "Mei", "Juni", "Juli", "Agustus", "September", "Oktober", "November", "Desember"];
            const startDate = new Date(startStr);
            const endDate = new Date(endStr);
            const startDay = startDate.getUTCDate(), startMonth = startDate.getUTCMonth(), startYear = startDate.getUTCFullYear();
            const endDay = endDate.getUTCDate(), endMonth = endDate.getUTCMonth(), endYear = endDate.getUTCFullYear();

            if (startYear === endYear && startMonth === endMonth && startDay === endDay) return `${startDay} ${months[startMonth]} ${startYear}`;
            if (startYear === endYear && startMonth === endMonth) return `${startDay} s.d. ${endDay} ${months[startMonth]} ${startYear}`;
            if (startYear === endYear) return `${startDay} ${months[startMonth]} s.d. ${endDay} ${months[endMonth]} ${startYear}`;
            return `${startDay} ${months[startMonth]} ${startYear} s.d. ${endDay} ${months[endMonth]} ${endYear}`;
        };

        const loadActivities = async () => {
            const snapshot = await getDocs(collection(db, "kegiatan"));
            allActivities = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            
            activityListEl.innerHTML = '';
            if(allActivities.length === 0) {
                activityListEl.innerHTML = '<li><div class="activity-item">Tidak ada kegiatan.</div></li>';
                return;
            }

            allActivities.forEach(activity => {
                const item = document.createElement('li');
                item.className = 'activity-item';
                item.dataset.id = activity.id;
                item.innerHTML = `
                    <strong>${activity.nama}</strong>
                    <span>${formatDateRange(activity.tanggalMulai, activity.tanggalBerakhir)}</span>
                `;
                activityListEl.appendChild(item);
            });
        };

        const populateEditor = (activity) => {
            const today = new Date();
            const tglSurat = `${today.getDate()} ${new Intl.DateTimeFormat('id-ID', { month: 'long' }).format(today)} ${today.getFullYear()}`;
            const linkPendaftaran = `${window.location.origin}${window.location.pathname.replace('editor-undangan.html', '')}daftar.html?id=${activity.id}`;

            pageContentEl.innerHTML = `
                <div style="text-align: center;">
                    <p style="margin:0; font-size:14pt; font-weight: bold;">PEMERINTAH KABUPATEN TANAH BUMBU</p>
                    <p style="margin:0; font-size:18pt; font-weight: bold;">DINAS PENDIDIKAN</p>
                    <p style="margin:0; font-size:10pt;">Alamat : Jln. Dharma Praja No.07 Kel. Gunung Tinggi Kec. Batulicin</p>
                    <p style="margin:0; font-size:10pt;">Laman : disdik.tanahbumbukab.go.id Pos-el : disdiktanahbumbu@gmail.com</p>
                </div>
                <hr style="border: none; border-top: 3px solid black; margin: 2px 0; height: 1px; background-color: black;">
                <hr style="border: none; border-top: 1px solid black; margin-top: 1px;">
                <br>
                <p style="text-align: right;">Batulicin, ${tglSurat}</p>
                <br>
                <table>
                    <tbody>
                        <tr><td style="width: 80px;">Nomor</td><td>:</td><td>B/400.3.5.3/ [NOMOR] /Disdik-PTK.2/IX/2025</td></tr>
                        <tr><td>Sifat</td><td>:</td><td>Biasa</td></tr>
                        <tr><td>Lampiran</td><td>:</td><td>1 (satu) lembar</td></tr>
                        <tr><td>Hal</td><td>:</td><td><b><u>Undangan Sosialisasi</u></b></td></tr>
                    </tbody>
                </table>
                <br>
                <p>Yth. Kepala TK Negeri se - Kabupaten Tanah Bumbu<br>(daftar TK terlampir)</p>
                <br>
                <p>di -<br>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<i>Tempat</i></p>
                <br>
                <p style="text-align: justify; text-indent: 1cm;">Dalam rangka meningkatkan kompetensi Pendidik dan Tenaga Kependidikan pada Jenjang PAUD, Dinas Pendidikan Kabupaten Tanah Bumbu akan melaksanakan ${activity.nama} yang bekerjasama dengan Balai Guru dan Tenaga Kependidikan (BGTK) Provinsi Kalimantan Selatan.</p>
                <p style="text-align: justify; text-indent: 1cm;">Sehubungan dengan hal tersebut, kami mohon kepada TK agar menugaskan 2 (dua) Guru ASN (PNS/P3K) untuk berperan aktif sebagai peserta dan berhadir pada kegiatan di maksud, yang akan di laksanakan pada :</p>
                <table style="margin-left: 1cm;">
                    <tbody>
                        <tr><td style="width: 80px;">Hari</td><td>:</td><td>${new Intl.DateTimeFormat('id-ID', { weekday: 'long' }).format(new Date(activity.tanggalMulai))}</td></tr>
                        <tr><td>Tanggal</td><td>:</td><td>${formatDateRange(activity.tanggalMulai, activity.tanggalBerakhir)}</td></tr>
                        <tr><td>Waktu</td><td>:</td><td>Jam 08.00 WITA sampai selesai</td></tr>
                        <tr><td>Tempat</td><td>:</td><td>${activity.tempat}</td></tr>
                    </tbody>
                </table>
                <br>
                <p style="text-align: justify; text-indent: 1cm;">Untuk kelancaran pelaksanaan kegiatan, dimohon untuk melakukan Registrasi Peserta pada link : ${linkPendaftaran} dan peserta hadir tepat waktu serta Pakaian disesuaikan dengan Pakaian Dinas Harian (PDH) pada waktu itu. untuk informasi lebih lanjut dapat menghubungi kontak ${activity.pj}.</p>
                <p style="text-align: justify; text-indent: 1cm;">Demikian disampaikan, atas perhatian dan kehadirannya di ucapkan terima kasih.</p>
                <br><br><br>
                <div style="width: 50%; float: right; text-align: center;">
                    <p style="margin:0;">Kepala Dinas,</p>
                    <br><br><br><br>
                    <p style="margin:0; font-weight: bold; text-decoration: underline;">Eka Saprudin, S.Pd., M.M</p>
                    <p style="margin:0;">Pembina Tingkat I (IV/b)</p>
                    <p style="margin:0;">NIP. 19670719 199412 1 004</p>
                </div>
            `;
            placeholderEl.style.display = 'none';
            pageContentEl.style.display = 'block';
            printButton.disabled = false;
        };

        activityListEl.addEventListener('click', (e) => {
            const item = e.target.closest('.activity-item');
            if(item) {
                document.querySelectorAll('.activity-item.active').forEach(el => el.classList.remove('active'));
                item.classList.add('active');
                const activityId = item.dataset.id;
                const selectedActivity = allActivities.find(a => a.id === activityId);
                if (selectedActivity) {
                    populateEditor(selectedActivity);
                }
            }
        });

        printButton.addEventListener('click', () => {
            window.print();
        });

        loadActivities();
    </script>
</body>
</html>

